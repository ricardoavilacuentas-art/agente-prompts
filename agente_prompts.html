<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prompt Studio</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#F7F6F3;--surface:#FFFFFF;--border:#E8E6E1;--border-strong:#D4D0C8;
  --text:#1A1916;--text-muted:#8A8680;--tag-bg:#EDEAE4;
  --success:#2D6A4F;--error:#C1121F;--error-bg:#FFE8E8;
  --radius:10px;--radius-sm:6px;--font:'DM Sans',sans-serif;
  --mono:'DM Mono',monospace;
  --shadow:0 1px 3px rgba(0,0,0,0.06);--shadow-lg:0 4px 24px rgba(0,0,0,0.08)
}
body{font-family:var(--font);background:var(--bg);color:var(--text);min-height:100vh;display:flex;font-size:15px;line-height:1.6}
.sidebar{width:260px;min-width:260px;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;height:100vh;position:sticky;top:0;overflow:hidden}
.sidebar-header{padding:24px 20px 20px;border-bottom:1px solid var(--border)}
.logo{display:flex;align-items:center;gap:10px;margin-bottom:4px}
.logo-icon{width:32px;height:32px;background:var(--text);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:16px;color:#fff;flex-shrink:0}
.logo-text{font-size:16px;font-weight:500;letter-spacing:-0.3px}
.logo-sub{font-size:12px;color:var(--text-muted);margin-left:42px}
.sidebar-section{padding:16px 20px;border-bottom:1px solid var(--border)}
.section-label{font-size:11px;font-weight:500;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.8px;margin-bottom:12px}
.api-input-wrap{position:relative}
.api-input{width:100%;padding:9px 36px 9px 12px;border:1px solid var(--border-strong);border-radius:var(--radius-sm);font-family:var(--mono);font-size:12px;background:var(--bg);color:var(--text);outline:none;transition:border-color 0.15s}
.api-input:focus{border-color:var(--text)}
.api-toggle{position:absolute;right:10px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--text-muted);font-size:14px}
.api-status{margin-top:6px;font-size:12px;color:var(--text-muted);display:flex;align-items:center;gap:5px}
.status-dot{width:6px;height:6px;border-radius:50%;background:var(--border-strong);flex-shrink:0}
.status-dot.active{background:#2D6A4F}
.ia-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px}
.ia-btn{padding:8px 6px;border:1px solid var(--border);border-radius:var(--radius-sm);background:var(--bg);cursor:pointer;text-align:center;transition:all 0.15s;font-family:var(--font)}
.ia-btn:hover{border-color:var(--border-strong);background:var(--surface)}
.ia-btn.active{border-color:var(--text);background:var(--text);color:#fff}
.ia-btn .ia-emoji{font-size:16px;display:block;margin-bottom:2px}
.ia-btn .ia-name{font-size:11px;font-weight:500}
.ia-btn.active .ia-name{color:#fff}
.ia-all-btn{grid-column:1/-1;padding:8px;border:1px solid var(--border);border-radius:var(--radius-sm);background:var(--bg);cursor:pointer;font-family:var(--font);font-size:12px;font-weight:500;color:var(--text-muted);transition:all 0.15s;display:flex;align-items:center;justify-content:center;gap:6px}
.ia-all-btn:hover{border-color:var(--border-strong);background:var(--surface);color:var(--text)}
.ia-all-btn.active{border-color:var(--text);background:var(--text);color:#fff}
.history-section{flex:1;overflow-y:auto;padding:16px 20px}
.history-empty{font-size:13px;color:var(--text-muted);text-align:center;padding:20px 0}
.history-item{padding:10px 12px;border-radius:var(--radius-sm);cursor:pointer;transition:background 0.12s;margin-bottom:4px;border:1px solid transparent}
.history-item:hover{background:var(--bg);border-color:var(--border)}
.history-ia{font-size:11px;color:var(--text-muted);margin-bottom:3px}
.history-preview{font-size:13px;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.history-clear{width:100%;padding:8px;border:none;background:none;color:var(--text-muted);font-size:12px;font-family:var(--font);cursor:pointer;text-align:center;margin-top:8px;border-radius:var(--radius-sm);transition:all 0.12s}
.history-clear:hover{background:var(--bg);color:var(--error)}
.main{flex:1;display:flex;flex-direction:column;max-width:780px;padding:40px 48px;margin:0 auto;width:100%}
.main-header{margin-bottom:32px}
.main-title{font-size:26px;font-weight:400;letter-spacing:-0.5px;margin-bottom:6px}
.main-subtitle{font-size:14px;color:var(--text-muted)}
.input-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;margin-bottom:20px;transition:box-shadow 0.2s}
.input-card:focus-within{box-shadow:var(--shadow-lg);border-color:var(--border-strong)}
.input-top{padding:16px 20px 0}
.input-label{font-size:12px;font-weight:500;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.6px;margin-bottom:10px}
textarea{width:100%;border:none;outline:none;font-family:var(--font);font-size:15px;color:var(--text);background:transparent;resize:none;line-height:1.6;min-height:100px}
textarea::placeholder{color:var(--border-strong)}
.input-bottom{display:flex;align-items:center;justify-content:space-between;padding:12px 20px 16px;gap:12px}
.char-count{font-size:12px;color:var(--text-muted)}
.generate-btn{display:flex;align-items:center;gap:8px;padding:10px 20px;background:var(--text);color:#fff;border:none;border-radius:var(--radius-sm);font-family:var(--font);font-size:14px;font-weight:500;cursor:pointer;transition:all 0.15s;white-space:nowrap}
.generate-btn:hover{background:#3D3A35;transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.15)}
.generate-btn:disabled{opacity:0.5;cursor:not-allowed;transform:none;box-shadow:none}
.btn-spinner{width:14px;height:14px;border:2px solid rgba(255,255,255,0.3);border-top-color:#fff;border-radius:50%;animation:spin 0.7s linear infinite;display:none}
.generate-btn.loading .btn-spinner{display:block}
.generate-btn.loading .btn-text{display:none}
@keyframes spin{to{transform:rotate(360deg)}}
.active-ia-badge{display:flex;align-items:center;gap:6px;padding:4px 10px;background:var(--tag-bg);border-radius:20px;font-size:12px;font-weight:500;color:var(--text)}
.chat-container{display:flex;flex-direction:column;gap:16px;margin-bottom:20px}
.chat-bubble{padding:16px 20px;border-radius:var(--radius);font-size:14px;line-height:1.75;animation:slideUp 0.2s ease;white-space:pre-wrap}
.chat-bubble.assistant{background:var(--surface);border:1px solid var(--border);box-shadow:var(--shadow)}
.chat-bubble.user{background:var(--text);color:#fff;align-self:flex-end;max-width:80%}
@keyframes slideUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.copy-btn{display:inline-flex;align-items:center;gap:5px;margin-top:12px;padding:6px 12px;border:1px solid var(--border);border-radius:var(--radius-sm);background:var(--bg);font-family:var(--font);font-size:12px;font-weight:500;color:var(--text);cursor:pointer;transition:all 0.12s}
.copy-btn:hover{border-color:var(--border-strong)}
.copy-btn.copied{color:var(--success);border-color:var(--success)}
.new-chat-btn{width:100%;padding:10px;border:1px dashed var(--border-strong);border-radius:var(--radius-sm);background:none;font-family:var(--font);font-size:13px;color:var(--text-muted);cursor:pointer;transition:all 0.12s;margin-bottom:20px}
.new-chat-btn:hover{background:var(--surface);color:var(--text);border-color:var(--text)}
.alert{padding:12px 16px;border-radius:var(--radius-sm);font-size:13px;margin-bottom:16px;display:none}
.alert.error{background:var(--error-bg);color:var(--error);border:1px solid #fcc;display:flex}
.alert.warning{background:#FFF8E6;color:#92400E;border:1px solid #FDE68A;display:flex}
.empty-state{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:60px 0;color:var(--text-muted)}
.empty-icon{font-size:40px;margin-bottom:16px;opacity:0.5}
.empty-title{font-size:16px;font-weight:500;color:var(--text);margin-bottom:6px}
.empty-desc{font-size:14px;max-width:320px}
.suggestions{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-top:20px}
.suggestion-chip{padding:7px 14px;border:1px solid var(--border);border-radius:20px;font-size:13px;cursor:pointer;background:var(--surface);transition:all 0.12s;color:var(--text)}
.suggestion-chip:hover{border-color:var(--text);background:var(--text);color:#fff}
@media(max-width:768px){.sidebar{display:none}.main{padding:24px 20px}}
</style>
</head>
<body>
<aside class="sidebar">
  <div class="sidebar-header">
    <div class="logo">
      <div class="logo-icon">‚ú¶</div>
      <span class="logo-text">Prompt Studio</span>
    </div>
    <div class="logo-sub">Creador de prompts pro</div>
  </div>
  <div class="sidebar-section">
    <div class="section-label">API Key</div>
    <div class="api-input-wrap">
      <input type="password" class="api-input" id="apiKey" placeholder="TU_API_KEY_AQUI..." oninput="checkApiKey()"/>
      <button class="api-toggle" onclick="toggleApiVisibility()">üëÅ</button>
    </div>
    <div class="api-status">
      <div class="status-dot" id="statusDot"></div>
      <span id="statusText">Ingresa tu API Key</span>
    </div>
  </div>
  <div class="sidebar-section">
    <div class="section-label">Optimizar para</div>
    <div class="ia-grid">
      <button class="ia-btn" data-ia="ChatGPT" onclick="selectIA(this)"><span class="ia-emoji">üí¨</span><span class="ia-name">ChatGPT</span></button>
      <button class="ia-btn" data-ia="Claude" onclick="selectIA(this)"><span class="ia-emoji">ü§ñ</span><span class="ia-name">Claude</span></button>
      <button class="ia-btn" data-ia="Midjourney" onclick="selectIA(this)"><span class="ia-emoji">üé®</span><span class="ia-name">Midjourney</span></button>
      <button class="ia-btn" data-ia="Gemini" onclick="selectIA(this)"><span class="ia-emoji">‚ú®</span><span class="ia-name">Gemini</span></button>
      <button class="ia-btn" data-ia="Stable Diffusion" onclick="selectIA(this)"><span class="ia-emoji">üñºÔ∏è</span><span class="ia-name">Stable Diff.</span></button>
      <button class="ia-btn" data-ia="GitHub Copilot" onclick="selectIA(this)"><span class="ia-emoji">üíª</span><span class="ia-name">Copilot</span></button>
      <button class="ia-all-btn active" data-ia="todas" onclick="selectIA(this)">‚ö° Mejor para todas</button>
    </div>
  </div>
  <div class="history-section">
    <div class="section-label">Historial</div>
    <div id="historyList"><div class="history-empty">A√∫n no hay conversaciones</div></div>
    <button class="history-clear" id="clearBtn" onclick="clearHistory()" style="display:none">Limpiar historial</button>
  </div>
</aside>
<main class="main">
  <div class="main-header">
    <h1 class="main-title">Genera tu prompt perfecto</h1>
    <p class="main-subtitle">Describe lo que necesitas ‚Äî te har√© preguntas para perfeccionarlo</p>
  </div>
  <div id="alertBox" class="alert"></div>
  <div class="chat-container" id="chatContainer"></div>
  <div class="empty-state" id="emptyState">
    <div class="empty-icon">‚ú¶</div>
    <div class="empty-title">Listo para crear</div>
    <div class="empty-desc">Describe lo que necesitas y te har√© preguntas para generar el prompt perfecto</div>
    <div class="suggestions">
      <div class="suggestion-chip" onclick="useSuggestion('Necesito un prompt para escribir emails de ventas')">Emails de ventas</div>
      <div class="suggestion-chip" onclick="useSuggestion('Quiero un prompt para Midjourney de un paisaje futurista')">Imagen futurista</div>
      <div class="suggestion-chip" onclick="useSuggestion('Dame un prompt para generar c√≥digo en Python')">C√≥digo Python</div>
      <div class="suggestion-chip" onclick="useSuggestion('Tengo este prompt y quiero mejorarlo')">Mejorar un prompt</div>
    </div>
  </div>
  <button class="new-chat-btn" id="newChatBtn" onclick="newChat()" style="display:none">+ Nueva conversaci√≥n</button>
  <div class="input-card">
    <div class="input-top">
      <div class="input-label" id="inputLabel">Tu petici√≥n</div>
      <textarea id="userInput" placeholder="Describe lo que necesitas o pega un prompt a mejorar..." oninput="updateCharCount()" onkeydown="handleKeydown(event)"></textarea>
    </div>
    <div class="input-bottom">
      <div style="display:flex;align-items:center;gap:10px;">
        <span class="char-count"><span id="charCount">0</span> caracteres</span>
        <div class="active-ia-badge" id="activeBadge">‚ö° Todas las IAs</div>
      </div>
      <button class="generate-btn" id="generateBtn" onclick="sendMessage()">
        <div class="btn-spinner"></div>
        <span class="btn-text">Enviar ‚Üí</span>
      </button>
    </div>
  </div>
</main>
<script>
let selectedIA = 'todas';
let conversationHistory = [];
let history = JSON.parse(localStorage.getItem('promptHistory2') || '[]');

function selectIA(btn) {
  document.querySelectorAll('.ia-btn,.ia-all-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  selectedIA = btn.dataset.ia;
  const badge = document.getElementById('activeBadge');
  if (selectedIA === 'todas') {
    badge.textContent = '‚ö° Todas las IAs';
  } else {
    const emoji = btn.querySelector('.ia-emoji') ? btn.querySelector('.ia-emoji').textContent : '‚ú¶';
    badge.textContent = emoji + ' ' + selectedIA;
  }
}

function checkApiKey() {
  const key = document.getElementById('apiKey').value.trim();
  const dot = document.getElementById('statusDot');
  const txt = document.getElementById('statusText');
  if (key.startsWith('sk-ant-') && key.length > 20) {
    dot.classList.add('active');
    txt.textContent = 'API Key lista';
  } else if (key.length > 0) {
    dot.classList.remove('active');
    txt.textContent = 'Formato incorrecto';
  } else {
    dot.classList.remove('active');
    txt.textContent = 'Ingresa tu API Key';
  }
}

function toggleApiVisibility() {
  const input = document.getElementById('apiKey');
  input.type = input.type === 'password' ? 'text' : 'password';
}

function updateCharCount() {
  document.getElementById('charCount').textContent = document.getElementById('userInput').value.length;
}

function useSuggestion(text) {
  document.getElementById('userInput').value = text;
  updateCharCount();
  document.getElementById('userInput').focus();
}

function handleKeydown(e) {
  if (e.key === 'Enter' && (e.metaKey || e.ctrlKey)) sendMessage();
}

function addBubble(text, role) {
  document.getElementById('emptyState').style.display = 'none';
  document.getElementById('newChatBtn').style.display = 'block';
  const container = document.getElementById('chatContainer');
  const bubble = document.createElement('div');
  bubble.className = 'chat-bubble ' + role;
  bubble.textContent = text;
  if (role === 'assistant') {
    const copyBtn = document.createElement('button');
    copyBtn.className = 'copy-btn';
    copyBtn.textContent = 'üìã Copiar respuesta';
    copyBtn.onclick = function() {
      navigator.clipboard.writeText(text).then(function() {
        copyBtn.textContent = '‚úì Copiado';
        copyBtn.classList.add('copied');
        setTimeout(function() {
          copyBtn.textContent = 'üìã Copiar respuesta';
          copyBtn.classList.remove('copied');
        }, 2000);
      });
    };
    bubble.appendChild(document.createElement('br'));
    bubble.appendChild(copyBtn);
  }
  container.appendChild(bubble);
  bubble.scrollIntoView({ behavior: 'smooth', block: 'end' });
}

async function sendMessage() {
  const apiKey = document.getElementById('apiKey').value.trim();
  const input = document.getElementById('userInput').value.trim();
  const btn = document.getElementById('generateBtn');
  hideAlert();

  if (!apiKey) return showAlert('Por favor ingresa tu API Key en el panel izquierdo', 'warning');
  if (!input) return showAlert('Por favor escribe algo', 'warning');

  const iaLabel = selectedIA === 'todas' ? 'todas las IAs' : selectedIA;
  const mensajeCompleto = conversationHistory.length === 0
    ? 'Optimizado para: ' + iaLabel + '\n\n' + input
    : input;

  addBubble(input, 'user');
  conversationHistory.push({ role: 'user', content: mensajeCompleto });
  document.getElementById('userInput').value = '';
  updateCharCount();
  document.getElementById('inputLabel').textContent = 'Tu respuesta';

  btn.classList.add('loading');
  btn.disabled = true;

  try {
    const response = await fetch('https://agente-prompts-production.up.railway.app/generar', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        apiKey: apiKey,
        mensaje: mensajeCompleto,
        historial: conversationHistory
      })
    });

    const data = await response.json();
    if (!response.ok) throw new Error(data.error || 'Error desconocido');

    const result = data.resultado || '';
    conversationHistory.push({ role: 'assistant', content: result });
    addBubble(result, 'assistant');
    addToHistory({ preview: input, ia: iaLabel, date: new Date() });

  } catch (err) {
    showAlert(err.message, 'error');
  } finally {
    btn.classList.remove('loading');
    btn.disabled = false;
  }
}

function newChat() {
  conversationHistory = [];
  document.getElementById('chatContainer').innerHTML = '';
  document.getElementById('emptyState').style.display = 'flex';
  document.getElementById('newChatBtn').style.display = 'none';
  document.getElementById('inputLabel').textContent = 'Tu petici√≥n';
  document.getElementById('userInput').value = '';
  updateCharCount();
}

function addToHistory(item) {
  history.unshift(item);
  if (history.length > 20) history = history.slice(0, 20);
  localStorage.setItem('promptHistory2', JSON.stringify(history));
  renderHistory();
}

function renderHistory() {
  const list = document.getElementById('historyList');
  const clearBtn = document.getElementById('clearBtn');
  if (history.length === 0) {
    list.innerHTML = '<div class="history-empty">A√∫n no hay conversaciones</div>';
    clearBtn.style.display = 'none';
    return;
  }
  clearBtn.style.display = 'block';
  list.innerHTML = history.map(function(item) {
    return '<div class="history-item"><div class="history-ia">‚ú¶ ' + item.ia + '</div><div class="history-preview">' + item.preview + '</div></div>';
  }).join('');
}

function clearHistory() {
  if (confirm('¬øBorrar todo el historial?')) {
    history = [];
    localStorage.removeItem('promptHistory2');
    renderHistory();
  }
}

function showAlert(msg, type) {
  const box = document.getElementById('alertBox');
  box.textContent = (type === 'error' ? '‚ö† ' : '‚óé ') + msg;
  box.className = 'alert ' + type;
}

function hideAlert() {
  document.getElementById('alertBox').className = 'alert';
}

renderHistory();
</script>
</body>
</html>